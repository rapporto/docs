SMS
==============================



Параметры запроса для отправки сообщения
----------------------------------------



.. csv-table:: Параметры для отправки сообщения
   :header: "Параметр", "Тип данных", "Описание"
   :widths: 30, 15, 30
   :class: my-table


   "login", "string", "Имя Партнёра."
   "password", "string", "Пароль Партнёра для отправки сообщений."
   "destAddr", "string", "Номер телефона абонента. Содержит код страны, код оператора и номер телефона. Для РФ код может быть '8', '7' или '+7'"
   "message", "object", "Параметры отправляемого сообщения."
   "message/type", "enum", "Тип сообщения. Передается значение *SMS*"
   "message/data", "string", "Параметры отправляемых данных."
   "message/data/text", "string", "Текст отправляемого сообщения, максимальный размер для SMS не более 2000 символов;"
   "message/data/serviceNumber", "string", "Сервисное имя, от которого осуществляется отправка сообщения."
   "message/data/ttl", "string", "Срок жизни сообщения. Для SMS срок жизни может быть от 1 до 2880 минут;"
   "message/data/ttlUnit", "string", "Единица измерения периода доставки сообщения. Допустимые значения: SECONDS, MINUTES (значение по-умолчанию), HOURS. Передается только дополнительно к ttl. Необязательный параметр"


Пример отправки SMS-сообщения
----------------------------------------

.. code-block:: json

    {
     {
       "login":"ВАШ_ЛОГИН",
       "password":"ВАШ_ПАРОЛЬ",
       "destAddr":"Номер_Абонента",
       "message":{
         "type":"SMS",
         "data":{
           "text":"Текст. Follow link: <http://verylongurl.com/very/long/url>",
           "serviceNumber":"НОМЕР_ОТПРАВИТЕЛЯ",
           "ttl":10
         }
       }
     }           
    }


Ответ на запрос отправки сообщения
----------------------------------

После отправки сообщения Сервис-провайдер синхронно возвращает ответ. В случае успешной отправки возвращается http-code 200 OK. Для ошибочных результатов http-код ответа будет отличный от 200.
Успешный результат отправки

В случае успешной отправки возвращается ответ с параметром **mtNum** в котором передается идентификатор сообщения, который присваивается ему Платформой при получении.

.. code-block:: json

    {
        "mtNum": "7390612217"
    }




Ошибки отправки SMS-сообщений 
-----------------------------

Параметры 
~~~~~~~~~~

В случае ошибки возвращается ответное сообщение со следующими параметрами:

.. csv-table:: Параметры сообщения об ошибке SMS
   :header: "Параметр", "Тип данных", "Описание"
   :widths: 30, 15, 30
   :class: my-table


   "error", "object", "Информация об ошибке"
   "error/code", "int", "Код ошибки"
   "error/description", "string", "Краткое описание ошибки"
   "extendedDescription", "string", "Подробное описание ошибки (не обязательный параметр)"



Пример ошибки отправки для SMS-сообщения
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: json

   {
       "error": {
           "code": 4,
           "description": "Invalid request"
       },
       "extendedDescription": "Message is too long (2618 symbols). SMS message max length is 2000 symbols."
   }



Коды ошибок отправки
~~~~~~~~~~~~~~~~~~~~


.. csv-table:: Коды ошибок отправки SMS
   :header: "Код", "Описание", "HTTP-код"
   :widths: 7, 30, 15
   :class: my-table


   1, "Service is unavailable", "503"
   2, "Invalid IP-address", "403"
   3, "Too many connections", "429"
   4, "Invalid request", "400"
   5, "Invalid login", "401"
   6, "Invalid password", "401"
   7, "serviceNumber is not defined", "400"
   8, "destAddr is not correct", "406"
   9, "Message type is not correct", "406"
   10, "Prohibited sending duplicates", "409"
   11, "Invalid TTL", "406"
   100, "100", "500"
   




MO-сообщение
============

На настроенный URL Партнёра передаётся MO-сообщение (сообщение от абонента в сторону Партнёра) в следующем формате:


.. csv-table:: Параметры MO-сообщений
   :header: "Параметр", "Тип", "Описание"
   :widths: 30, 15, 30
   :class: my-table


   "transactionId", "string", "Идентификатор транзакции, созданный системой Сервис-Провайдера."
   "destAddr", "string", "Сервисный номер, на который абонент отправил сообщение."
   "sourceAddr", "string", "Номер абонента."
   "type", "string", "Тип сообщения."
   "message", "string", "Текст сообщения Партнёру от абонента."
   "partCount", "integer", "Количество частей сообщения."
   "receivedDate", "string", "Дата получения данного MO-сообщения от абонента."
   "mediaURL", "string", "Ссылка на изображение. Параметр необязательный, если вложение отсутствует."
   


Пример МО для SMS:

.. code-block:: json

    { 
      "transactionId": "20190418175651967013", 
      "destAddr": "0000", 
      "sourceAddr": "72101234567", 
      "type": "SMS", 
      "message": "Сообщение для партнёра", 
      "partCount": 1,
      "receivedDate": "2022-06-22T10:22:45+0300" 
    }




Причины недоставки сообщений
----------------------------

Если сообщение успешно принято к отправки, то для получения статусов сообщения необходимо настроить получение статусов, подробнее в документе :doc:`rest_status`

Параметр errorCode при успешном выполнении отправки равен 0. При status = 5 возвращает код ошибки.


Причины недоставки SMS:

+---------+----------------------------+----------------------------+
| **Код** | **Сообщение об ошибке**    | **Описание ошибки**        |
+---------+----------------------------+----------------------------+
| 1       | unknown                    | В процессе доставки        |
|         |                            | сообщения произошла        |
|         |                            | неизвестная платформе      |
|         |                            | ошибка, либо оператор не   |
|         |                            | предоставил ошибку в       |
|         |                            | отчете о доставке.         |
+---------+----------------------------+----------------------------+
| 2       | absent-subscriber          | Аппарат абонента был       |
|         |                            | выключен или находился вне |
|         |                            | зоны действия сети на      |
|         |                            | протяжении всего времени   |
|         |                            | попыток доставки           |
|         |                            | сообщения.                 |
+---------+----------------------------+----------------------------+
| 3       | call-barred                | Аппарат абонента           |
|         |                            | заблокирован, либо у       |
|         |                            | абонента включен запрет на |
|         |                            | прием сообщений, либо      |
|         |                            | абонент находится в        |
|         |                            | роуминге с включенным      |
|         |                            | запретом на прием          |
|         |                            | сообщений в роуминге.      |
+---------+----------------------------+----------------------------+
| 4       | failure                    | В процессе доставки        |
|         |                            | сообщения произошла ошибка |
|         |                            | на транспортном уровне     |
|         |                            | сигнальной сети.           |
+---------+----------------------------+----------------------------+
| 5       | memory-capacity-exceeded   | Память телефона абонента   |
|         |                            | переполнена.               |
+---------+----------------------------+----------------------------+
| 6       | t                          | У абонента не подключена   |
|         | eleservice-not-provisioned | услуга приема сообщений.   |
+---------+----------------------------+----------------------------+
| 7       | timeout                    | Коммутационное             |
|         |                            | оборудование, на котором   |
|         |                            | зарегистрирован абонент,   |
|         |                            | не отвечает.               |
+---------+----------------------------+----------------------------+
| 8       | unknown-subscriber         | Некорректный номер         |
|         |                            | абонента, либо телефон     |
|         |                            | абонента был выключен на   |
|         |                            | протяжении очень долгого   |
|         |                            | периода времени.           |
+---------+----------------------------+----------------------------+
| 9       | duplicated                 | Сообщение было отброшено   |
|         |                            | платформой, так как        |
|         |                            | сработал механизмом        |
|         |                            | отсечения дубликатов       |
|         |                            | сообщений.                 |
+---------+----------------------------+----------------------------+
| 10      | filtered                   | Сообщение было отброшено   |
|         |                            | платформой, так как        |
|         |                            | сработал один из фильтров  |
|         |                            | сообщений, например,       |
|         |                            | спам-фильтр.               |
+---------+----------------------------+----------------------------+
| 11      | unrouted                   | Ошибка маршрутизации в     |
|         |                            | конфигурации платформы.    |
+---------+----------------------------+----------------------------+
| 12      | oper-blacklisted           | Номер абонента находится в |
|         |                            | чёрном списке оператора.   |
+---------+----------------------------+----------------------------+
| 13      | oper-invsrcaddr            | Отправка сообщения с       |
|         |                            | незарегистрированного у    |
|         |                            | оператора имени            |
|         |                            | отправителя.               |
+---------+----------------------------+----------------------------+
| 14      | oper-spamfiltered          | На стороне оператора       |
|         |                            | сработал СПАМ-фильтр по    |
|         |                            | тексту сообщения.          |
+---------+----------------------------+----------------------------+