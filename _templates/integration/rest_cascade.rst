Каскадная отправка
=====================================


Каскадной отправкой считается переотправка сообщения в другие каналы в случае получения неуспешного статуса отправленного сообщения.
Переотправка сообщения доступна по неполучению статусов DELIVERED или READ. Для отправки цепочки сообщений разного типа требуется передавать дополнительный блок параметров **CascadeChainLink**\ *.*

Статусы переотправки для каскада
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Причиной для переотправки сообщения является неполучение одно из статусов Получено (DELIVERED) или Прочитано (READ) в течение времени жизни сообщения(параметр ttl). Время жизни по-умолчанию задается при настройке интеграционного подключения или передается в параметре ttl при отправке сообщения. Для каждого сообщения из цепочки каскада время жизни задается отдельно.

Для сообщения типа FlashingCall(Voice Code) возможна переотправка только по статусу Получено (DELIVERED).

В случае включенной на клиенте настройке “Получать промежуточные статусы” при отправке каскадной цепочки сообщений (параметр registeredDelivery": "1") будут приходить отчёты по всем типам
сообщений.

Каскадная отправка Viber + SMS
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: json

    {
      "login": "ВАШ_ЛОГИН",
      "password": "ВАШ_ПАРОЛЬ",
      "id": "8770100",
      "destAddr": "Номер_Абонента",
      "message": {
        "type": "VIBER",
        "data": {
          "instantContent": {
            "type": "TEXT",
            "data": {
              "text": "VIBERMESS"
            }
          },
          "serviceNumber": "НОМЕР_ОТПРАВИТЕЛЯ",
          "ttl": 1
        }
      },
      "cascadeChainLink": {
        "state": "READ",
        "message": {
          "type": "SMS",
          "data": {
            "text": "SMSMESS",
            "serviceNumber": "НОМЕР_ОТПРАВИТЕЛЯ",
            "ttl": 1,
            "ttlUnit": "HOURS"
          }
        }
      }
    }




Каскадная отправка PUSH + SMS
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: json


   {
   "login":"ВАШ_ЛОГИН",
     "password":"ВАШ_ПАРОЛЬ",
     "id":"8770631",
     "destAddr":"Номер_Абонента",
     "message":{
       "type":"PUSH",
       "data":{
         "title":"Заголовок Push-cсообщения",
         "text":"Текст уведомления",
         "serviceNumber":"НОМЕР_ОТПРАВИТЕЛЯ",
         "ttl":2
       }
     },
     "cascadeChainLink": {
       "state": "DELIVERED",
       "message": {
         "type": "SMS",
         "data": {
           "text": "Текст доотправляемого SMS-сообщения",
           "serviceNumber": "НОМЕР_ОТПРАВИТЕЛЯ_SMS",
           "ttl": 2
         }
       }
     }
   }




