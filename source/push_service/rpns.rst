Сервис Rapporto Push Notification System
========================================

Сервис Rapporto Push Notification System (далее — RPNS) позволяет управлять отправкой push-сообщений на мобильные приложения и получением статусов отправки этих сообщений.

Функциональные возможности сервиса RPNS:

* отправка push-сообщений как по номеру телефона, так и по идентификатору пользователя в системе Партнёра;
* отправка push-сообщений с заголовком и текстом (см. рис. 1), с изображением (см. рис. 2), с кнопками (см. рис. 3) и с :abbr:`webview (При открытии push-сообщения выполняется переход на веб-ресурс или внутреннюю страницу приложения)` (см. рис. 4);
* отправка push-сообщений с данными для обновления :abbr:`Live Activity (Позволяет отображать интерактивную информацию с помощью виджета на заблокированном экране устройства. Доступно только для iOS)`;
* отправка push-сообщений с данными для его :abbr:`обогащения (Альтернативный способ отправки push-сообщений с контенотом в мобильное приложение)`;
* отправка push-сообщений с :abbr:`чувствительными данными (Информация, которая требует особого внимания и защиты из-за своей конфиденциальности или потенциальной уязвимости. К таким данным можно отнести персональные данные пользователя, уведомления с кодами безопасности от банков и т.п.)`;
* настройка подписок на уровне приложения (сегментирование клиентской базы, типизация трафика);
* сохранение истории доставленных push-сообщений в приложении с отображением статусов "Доставлено" и "Прочитано";
* детализация статусов push-сообщений;
* осуществление веерной доставки уведомлений на несколько устройств пользователя либо только на :abbr:`основное (Статус основной установки присваивается текущей установке приложения, когда пользователь запускает приложение и проходит авторизацию. Такой признак может быть только у одной установки, связанной с пользователем)`;
* отправка push-сообщений каскадным способом по альтернативным каналам, настроенным на платформе Сервис-провайдера;
* осуществление массовых рассылок уведомлений, отложенных по времени (с отправкой в будущем);
* отслеживание запрета на приём push-сообщений на уровне ОС устройства пользователя;
* агрегирование информации об устройствах пользователя и частоте их использования;
* отправка push-сообщений с привязкой к часовому поясу получателя.

.. cssclass:: no-border-table

    +-----------------------------------------------------+----------------------------------------------+
    | .. image:: media/push_text_1.png                    | .. image:: media/push_image_2.jpg            |
    |     :width: 200                                     |     :width: 200                              |
    |                                                     |                                              |
    |Рис. 1. Push-сообщение с заголовком и текстом        |Рис. 2. Push-сообщение с изображением         |
    +-----------------------------------------------------+----------------------------------------------+
    | .. image:: media/push_buttons_3.png                 | .. image:: media/push_webview_4.png          |
    |     :width: 200                                     |     :width: 200                              |
    |                                                     |                                              |
    |Рис. 3. Push-сообщение с кнопками                    |Рис. 4. Push-сообщение с webview              |
    +-----------------------------------------------------+----------------------------------------------+

Существуют следующие варинаты отправки контента в push-сообщениях:

1. rich push (содержательные push-сообщения) — возможность отправлять уведомления, содержащие изображения, кнопки выбора действия, эмодзи (изображения эмоций) а также ссылки на веб-ресурсы (webview), позволяющие организовать интерактивное взаимодействие с пользователем (вплоть до чата);

2. custom payload (пользовательская информация) — возможность передавать произвольную системную информацию в формате JSON для обработки в приложении и организации пользовательских сценариев.

Данный сервис даёт возможность экономии средств за счет использования канала связи для отправки push-сообщений вместо SMS-сообщений. RPNS поддерживает подключение push-сообщений для устройств на базе Android, iOS и Huawei.

Логика работы и взаимодействие компонентов сервиса RPNS:

1. Конечный пользователь устанавливает мобильное приложение со встроенным SDK Rapporto.

2. SDK делает запрос токена устройства в облачный сервис PNS — APNS для iOS, FCM или RuStore для Android, HMS для Huawei.

3. SDK передаёт токен, а также номер телефона и/или идентификатор пользователя в RPNS, где они сохраняются в базу данных сервиса.

4. Полученные данные обрабатываются в сервисе RPNS и производится связка токена с телефонным номером и/или идентификатором пользователя.

5. После получения запроса на отправку push-сообщения начинается его обработка.

6. Далее уведомление передаётся в облачные сервисы PNS.

7. После доставки push-сообщения на устройство пользователя SDK передаёт, а RPNS обрабатывает и предоставляет необходимые статусы отправленного уведомления (доставки, просмотра).

Отправка уведомлений осуществляется по REST API. Подробное описание протокола смотрите в разделе REST API — :doc:`/api/rest/rest_push`.

Если остались вопросы по работе сервиса RPNS, просим обращаться в `службу технической поддержки <https://doc.rapporto.ru/support.html>`_.
