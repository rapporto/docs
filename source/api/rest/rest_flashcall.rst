FlashingCall (VoiceCode)
===========================

Запрос FlashingCall (VoiceCode)
--------------------------------

Для передачи сообщения с типом :term:`FlashingCall` необходимо выполнить запрос.

Для отправки :term:`VoiceCode` необходимо указать тип сообщения :term:`FlashingCall` и передать запрос, содержащий код. 
Указанный код (без сопутствующего текста) будет передан оператору, который вставит его в текст шаблона сообщения. 



.. tabs::

   .. tab:: Пример запроса

      .. code-block:: json
         :linenos:


         {
         "login": "ВАШ_ЛОГИН",
         "password": "ВАШ_ПАРОЛЬ",
         "destAddr": "НОМЕР_АБОНЕНТА",
         "message": {
            "type": "FLASHINGCALL",
            "data": {
               "text": "1234",
               "ttl": 1 
            }
         }
         }


   .. tab:: Параметры запроса

      Все параметры обязательные.

      .. csv-table:: 
          :header: "Параметр", "Тип данных", "Описание"
          :widths: 20, 15, 45
          :class: my-table

          "**login**", "string", "Имя Партнера в системе."
          "**password**", "string", "Пароль Партнера в системе."
          "**destAddr**", "string", "Номер телефона абонента. Содержит код страны, код оператора и номер телефона. Для РФ код может быть '8', '7' или '+7'. Примеры: 72101234567, +72101234567, 8-210-123-45-67, 82101234567."
          "**message**", "object", "Параметры отправляемого сообщения."
          "**message/type**", "enum", "Тип сообщения. Передается значение *FLASHINGCALL*."
          "**message/data**", "object", "Параметры отправляемых данных."
          "**message/data/text**", "string", "Текст отправляемого сообщения. Количество символов: не более 2000. Текст должен содержать код, используемый для звонка на номер абонента сотового оператора."
          "**message/data/ttl**", "integer", "Срок жизни сообщения FLASHINGCALL (Voice Code). Интервал ожидания ответа о совершении звонка - от 1 до 5 минут. Примечание. При ttl = 0 или отсутствии параметра в запросе берётся значение из настроек по умолчанию, которые задаются при настройке интеграции отдельно для каждого клиента."



Результат запроса FlashingCall
--------------------------------

| Результатом выполнения запроса :term:`FlashingCall` будет звонок на телефон абонента со специальной номерной ёмкости. 
| Последними цифрами номера вызывающего абонента является код, который передается в тексте сообщения. 
| Передаваемый код сообщения в тексте должен состоять из четырёх, либо шести цифр. 
| Интервал ожидания ответа (ttl) о совершении звонка — от 1 до 5 минут.
| После отправки сообщения Сервис-провайдер синхронно возвращает ответ.


Результат запроса VoiceCode
----------------------------

| Результатом запроса :term:`VoiceCode` будет звонок на телефон абонента. Когда абонент снимет трубку, он услышит голосовое сообщение, которое будет содержать код из четырёх цифр.
| Для подключения данной услуги необходимо обратиться в Службу технической поддержки и согласовать текст шаблона голосового сообщения.


Ошибки при отправке FlashingCall (VoiceCode)-сообщений 
-------------------------------------------------------

Для ошибочных результатов HTTP-код ответа будет отличный от 200 (см. :ref:`Коды-ошибок-отправки-FC`).

.. tabs::

   .. tab:: Пример ответа

      .. code-block:: json
         :linenos:

         { 
            "error": { 
               "code": 4, 
               "description": "Invalid request" 
            }, 
            "extendedDescription": "FlashingCall text should contain a 4-digit code." 
         }
        


   .. tab:: Параметры ответа

      .. csv-table:: 
        :header: "Параметр", "Тип данных", "Описание"
        :widths: 30, 15, 35
        :class: my-table

        "error", "object", "Информация об ошибке"
        "error/code", "int", "Код ошибки"
        "error/description", "string", "Краткое описание ошибки"
        "extendedDescription", "string", "Подробное описание ошибки (необязательный параметр)"


.. _Коды-ошибок-отправки-FC:

Коды ошибок отправки  
~~~~~~~~~~~~~~~~~~~~~~~

.. csv-table:: 
   :header: "Код", "Описание", "HTTP-код"
   :widths: 7, 30, 15
   :class: my-table

   1, "Service is unavailable", "503"
   2, "Invalid IP-address", "403"
   3, "Too many connections", "429"
   4, "Invalid request", "400"
   5, "Invalid login", "401"
   6, "Invalid password", "401"
   7, "serviceNumber is not defined", "400"
   8, "destAddr is not correct", "406"
   9, "Message type is not correct", "406"
   10, "Prohibited sending duplicates", "409"
   11, "Invalid TTL", "406"
   100, "100", "500"



Статусы доставки FlashingCall (VoiceCode)-сообщений
-----------------------------------------------------

Для получения статусов FlashingCall (VoiceCode)-сообщений необходимо настроить :doc:`rest_status`.
