
Сервис сокращения ссылок
===========================

Описание сервиса
-------------------

Функциональные возможности сервиса:

* замена :term:`длинных ссылок <Длинная ссылка>` в тексте сообщений на короткие;
* хранение соответствия ссылок;
* выполнение переадресации с :term:`короткой ссылки <Короткая ссылка>` на длинную;
* сбор статистики переходов. 

| Данный сервис подключается Сервис-провайдером по запросу от Партнера (см. :ref:`Rest-Подключение-ССС`).
| После того, как Сервис-провайдер выполнит настройку Сервиса, все полученные ссылки в тексте сообщений будут сокращаться по-умолчанию в соответствии с заданными настройками.
| При необходимости, данной настройкой можно управлять также при помощи опционального параметра *shortenLinks*, который может быть отправлен в запросе.
| В случае, если сервис настроен, а параметр не отправлен, то ссылка будет сокращена по-умолчанию. То же касается и ссылок, переданных в :ref:`каскадных сообщениях <Ссылки-в-каскаде>`.
| Ссылка сокращается с использованием домена **http://kr4.me**.

Сокращаются ссылки для следующих типов сообщений:

* SMS (см. :ref:`Rest-SMS-параметры-запроса`);
* Viber (см. :ref:`Rest-Viber-параметры-запроса`);
* Push (см. :ref:`Rest-Push-параметры-запроса`);
* VK (см. :ref:`Rest-VK-параметры-запроса`);
* WhatsApp (см. :ref:`Rest-WA-параметры-запроса`).


Алгоритм работы сервиса
-------------------------

1. При выявлении длинной ссылки в сообщении формируется новая ссылка - в начало новой ссылки подставляется домен http://kr4.me/ и добавляется уникальный идентификатор :term:`UID`, длина которого может составлять от 3 до 8 символов. Пример ссылки после сокращения: http://kr4.me/EQiCREB.
2. После доставки сообщений, при переходе абонентов по короткой ссылке сервис сокращения ссылок определит соответствующую длинную ссылку и осуществит переадресацию.
3. Переходы по каждой ссылке будут фиксироваться в статистике Платформы.


.. _Rest-Подключение-ССС:

Подключение сервиса
-------------------------

Для подключения Сервиса в :ref:`Службу технической поддержки <support>` необходимо передать следующие данные:

* количество символов, после которых необходимо сокращать ссылку. Например, в случае, если сокращать ссылку более 26 символов, то ссылка https://rapporto.ru/ будет передана абоненту в неизменном виде, а ссылка https://rapporto.ru/company/o_platforme_rapporto/ будет сокращена, например `http://kr4.me/QEiCRE/ <https://rapporto.ru/company/o_platforme_rapporto/>`_;
* количество символов в :term:`UID`, который добавляется после домена. Данный параметр влияет на количество уникальных ссылок, которые возможно будет сформировать. Например, с длиной  UID = 8 символов можно сформировать около 281 триллиона уникальных ссылок;
* уточнить необходимость формирования уникальных ссылок для каждого абонента. Данный параметр влияет на статистику переходов, в случае единой ссылки для всех абонентов будет показана общая статистика переходов по ней;
* количество дней, по прошествии которых удаляется неактивная ссылка, если по ней не было переходов;
* время жизни ссылки - количество дней, по прошествии которых удаляется неактивная ссылка, даже если по ней были переходы.


.. _Ссылки-в-каскаде:

Сокращение ссылок при передаче каскадных сообщений
-----------------------------------------------------

Если для REST-клиента настроена :doc:`rest_cascade`, то для отправляемых сообщений выполняются те же требования, что и для одиночных:

* при включенном Сервисе ссылки сокращаются автоматически для всех сообщений каскада;
* для управления сокращением ссылок для сообщений используется параметр *shortenLinks*. В случае, если параметр не передается, то ссылки в сообщении сокращаются;
* параметр *shortenLinks* должен быть указан в блоке *message* для каждого сообщения каскада.
