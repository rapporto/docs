Push
=====
Отправка push-уведомлений
--------------------------

В push-уведомлениях доступна передача текста и, опционально, дополнительных параметров.

Примеры дополнительных параметров:

* заголовок; 
* изображения;
* кнопки выбора действия;
* :abbr:`HTML (HyperText Markup Language)`-страницы;
* шаблоны для передачи чувствительных данных;
* параметры для обогащения данных;
* данные без предварительной обработки (в формате JSON);
* клиентские данные для статистики;
* данные для обновления виджета :abbr:`Live Activity (Виджет Live Activity функционирует на устройствах с iOS)`;
* признак главного приложения;
* подписки мобильного приложения;
* указание провайдеров (:abbr:`APNS (Apple Push Notification Service)`, :abbr:`FCM (Firebase Cloud Messaging)`, :abbr:`HMS (Huawei Mobile Services)`, RuStore) для передачи данных.



.. _примеры-запросов:

Примеры запросов на отправку push-уведомлений
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

..
   .. raw:: html

      <p style="line-height: 24px;">Для формирования тестового запроса с вашими параметрами 
         <a href="https://maxim84.tmweb.ru/rest" target="_blank" class="button">
            <img src="../../_static/link-external-01.svg" class="bttn-icon" alt="Внешняя ссылка"> Открыть генератор запросов
         </a>
      </p>
      <style>
         .bttn-icon {
            width: 18px;
            height: 18px;
            vertical-align: middle;  /* Центрирует иконку по вертикали */
            border: 0;
            margin-right: 4px;
         }       
         .button {
            border: 0;
            height: 36px;
            text-decoration: none; /* Убирает подчеркивание */
            color: #000; /* Цвет текста */
            background-color: transparent; /* Цвет фона кнопки */
            padding: 4px 4px; /* Отступы */
            border-radius: 4px; /* Закругленные углы */
            display: inline-flex; /* Позволяет выровнять текст и иконку по центру */
            align-items: center; /* Центрирует содержимое кнопки */
            line-height: 1; /* Убирает лишние отступы */
         }
         .button:hover {
            background-color: #f8f7ff; /* Цвет фона при наведении */
            text-decoration: none; /* Убирает подчеркивание */
         }
      </style>

.. tabs::

    .. tab:: расширенный запрос

        Описание параметров `useTimeDiff`_ ; `destAddr`_  

        .. code-block:: json
           :linenos:
           :emphasize-lines: 5,6,8-12,23,24 

             {
                {
                   "login":"ВАШ_ЛОГИН",
                   "password":"ВАШ_ПАРОЛЬ",
                   "extraParam":"param1=value1,param2=value2",
                   "useTimeDiff":true,
                   "id":"8770630",
                   "scheduleInfo":{
                     "timeBegin":"10:00",
                     "timeEnd":"12:00",
                     "weekdaysSchedule":"123",
                     "deadline": "2029-12-31T16:29:30+0300"
                   },
                   "destAddr":"Номер_Абонента",
                   "message":{
                     "type":"Push",
                     "data":{
                       "externalUserId": "ID_абонента",
                       "text":"Текст уведомления",
                       "serviceNumber":"НОМЕР_ОТПРАВИТЕЛЯ",
                       "ttl":10,
                       "ttlUnit": "SECONDS",
                     "registeredDelivery":"1",
                     "notifyUrl":"URL_для_передачи_статусов"
                     }
                   }
                }           
             }



    .. tab:: с текстом  
                       
        .. code-block:: json
           :linenos:
           :emphasize-lines: 9

             {
                "login":"ВАШ_ЛОГИН",
                "password":"ВАШ_ПАРОЛЬ",
                "id":"8770631",
                "destAddr":"Номер_Абонента",
                "message":{
                   "type":"PUSH",
                   "data":{
                      "text":"Текст уведомления",
                      "serviceNumber":"НОМЕР_ОТПРАВИТЕЛЯ",
                      "ttl":2
                   }
                }
             }


    .. tab:: с текстом и заголовком

        Описание параметра `title`_

        .. code-block:: json
           :linenos:
           :emphasize-lines: 9,10

             {
                "login":"ВАШ_ЛОГИН",
                "password":"ВАШ_ПАРОЛЬ",
                "id":"8770631",
                "destAddr":"Номер_Абонента",
                "message":{
                   "type":"PUSH",
                   "data":{
                      "title":"Заголовок Push-cсообщения",
                      "text":"Текст уведомления",
                      "serviceNumber":"НОМЕР_ОТПРАВИТЕЛЯ",
                      "ttl":2
                   }
                }
             }


    .. tab:: с признаком главного приложения

        Описание параметра `primaryOn`_

        .. code-block:: json
           :linenos:
           :emphasize-lines: 10

             {
                "login":"ВАШ_ЛОГИН",
                "password":"ВАШ_ПАРОЛЬ",
                "id":"8770631",
                "destAddr":"Номер_Абонента",
                "message":{
                   "type":"PUSH",
                   "data":{
                      "text":"Текст уведомления",
                      "primaryOn":true,
                      "serviceNumber":"НОМЕР_ОТПРАВИТЕЛЯ",
                      "ttl":2
                   }
                }
             }


    .. tab:: с изображением

        В данном примере сообщение передается по *externalUserId* клиента.
        Описание параметра `contentCategory`_

        .. code-block:: json
           :linenos:
           :emphasize-lines: 13-15

             {
                "login": "ВАШ_ЛОГИН",
                "password": "ВАШ_ПАРОЛЬ",
                "id": "9999992",
                "message": {
                   "type": "PUSH",
                   "data": {
                      "externalUserId": "ИД_абонента",
                      "text": "Текст_сообщения",
                      "serviceNumber": "0000",
                      "ttl": 40,
                      "ttlUnit": "SECONDS",
                      "content": {
                         "contentCategory": "IMAGE",
                         "contentUrl": "https://i.pinimg.com/originals/11/ab/14/11ab147894a7d2ce866ff88a4aa63655.jpg"
                      }
                   }
                }
             }
    

    .. tab:: с изображением и кнопками

        В данном примере сообщение передается по *externalUserId* клиента.
        
        Описание параметров `contentCategory`_ ; `actions`_

        .. code-block:: json
           :linenos:
           :emphasize-lines: 13-25

             {
                "login": "ВАШ_ЛОГИН",
                "password": "ВАШ_ПАРОЛЬ",
                "id": "9999992",
                "message": {
                   "type": "PUSH",
                   "data": {
                      "externalUserId": "ИД_абонента",
                      "text": "Текст_сообщения",
                      "serviceNumber": "0000",
                      "ttl": 40,
                      "ttlUnit": "SECONDS",
                      "content": {
                         "contentCategory": "IMAGE",
                         "contentUrl": "https://i.pinimg.com/originals/11/ab/14/11ab147894a7d2ce866ff88a4aa63655.jpg",
                         "actions": [
                            {
                               "title": "Открыть",
                               "action": "link",
                               "options": "https://doc.rapporto.ru/"
                            },
                            {
                               "title": "Открыть приложение",
                               "action": "open-app",
                               "options": ""
                            }
                         ]
                      }
                   }
                }
             }
    
                   
    .. tab:: с HTML-страницей

        Описание параметра `contentCategory`_

        .. code-block:: json
           :linenos:
           :emphasize-lines: 13-15

             {
                "login": "ВАШ_ЛОГИН",
                "password": "ВАШ_ПАРОЛЬ",
                "id": "9999992",
                "destAddr":"Номер_Абонента",
                "message": {
                   "type": "PUSH",
                   "data": {
                      "text": "Текст_сообщение",
                      "serviceNumber": "0000",
                      "ttl": 40,
                      "ttlUnit": "SECONDS",
                      "content": {
                         "contentCategory": "HTML",
                         "contentUrl": "https://i.pinimg.com/originals/11/ab/14/11ab147894a7d2ce866ff88a4aa63655.jpg"
                      }
                   }
                }
             }


    .. tab:: с подписками

        Описание параметра `deviceSubscriptions`_

        .. code-block:: json
           :linenos:
           :emphasize-lines: 14,15

            {
               "login":"ВАШ_ЛОГИН",
               "password":"ВАШ_ПАРОЛЬ",
               "id":"8770631",
               "destAddr":"Номер_Абонента",
               "message":{
                  "type":"PUSH",
                  "data":{
                     "externalUserId":"ИД_абонента",
                     "text":"Текст",
                     "serviceNumber":"Номер_отправителя",
                     "ttl":24,
                     "ttlUnit":"HOURS",
                     "deviceSubscriptions":[
                        "card"
                     ]
                  }
               }
            }

   

    .. tab:: с данными для приложения

        Описание параметра `customPayload`_

        .. code-block:: json
           :linenos:
           :emphasize-lines: 14,15

            {
               "login":"ВАШ_ЛОГИН",
               "password":"ВАШ_ПАРОЛЬ",
               "id":"8770631",
               "destAddr":"Номер_Абонента",
               "message":{
                  "type":"PUSH",
                  "data":{
                     "title":"Заголовок Push-сообщения",
                     "text":"Текст_сообщения",
                     "serviceNumber":"Номер_отправителя",
                     "ttl":1,
                     "ttlUnit":"MINUTES",
                     "customPayload":{
                        "list":"card"
                     }
                  }
               }
            }

   
    .. tab:: с данными для статистики

        Описание параметра `callbackData`_

        .. code-block:: json
           :linenos:
           :emphasize-lines: 14
           
            {
               "login":"ВАШ_ЛОГИН",
               "password":"ВАШ_ПАРОЛЬ",
               "id":"8770631",
               "destAddr":"Номер_Абонента",
               "message":{
                  "type":"PUSH",
                  "data":{
                     "title":"Заголовок Push-сообщения",
                     "text":"Текст_сообщения",
                     "serviceNumber":"Номер_отправителя",
                     "ttl":1,
                     "ttlUnit":"MINUTES",
                     "callbackData":"Данные_для_статистики"
                  }
               }
            }



    .. tab:: с обогащенными данными
         
        .. tabs::
        
            .. tab:: RICH
            
                Параметры для альтернативного варианта отправки данных с контентом для мобильного приложения.       

                .. code-block:: json
                   :linenos:
                   :emphasize-lines: 14-19

                    {
                       "login":"ВАШ_ЛОГИН",
                       "password":"ВАШ_ПАРОЛЬ",
                       "id":"4560",
                       "message":{
                          "type":"PUSH",
                          "data":{
                             "externalUserId":"ИД_абонента",
                             "title":"Заголовок_до",
                             "text":"Тест_до",
                             "serviceNumber":"Номер_отправителя",
                             "ttl":30,
                             "ttlUnit":"SECONDS",
                             "extraOptions":[
                                {
                                   "param_name":"RICH",
                                   "param_value":{
                                      "title":"Заголовок_после",
                                      "message":"Текст_после"
                                   }
                                }
                             ]
                          }
                       }
                    }
        
        
            .. tab:: LIVE_ACTIVITY

                Параметры для обновления виджета Live Activity на устройствах с операционной системой iOS. 
        
                .. code-block:: json
                   :linenos:
                   :emphasize-lines: 14-23

                    {
                       "login":"ВАШ_ЛОГИН",
                       "password":"ВАШ_ПАРОЛЬ",
                       "id":"4560",
                       "message":{
                          "type":"PUSH",
                          "data":{
                             "externalUserId":"ИД_абонента",
                    	 "title":"Заголовок",
                             "text":"Текст",
                             "serviceNumber":"Номер_отправителя",
                             "ttl":30,
                             "ttlUnit":"SECONDS",
                             "Options":[
                                {
                                   "param_name":"LIVE_ACTIVITY",
                                   "param_value":{
                                      "aps":{
                                         "timestamp":"2024-03-29T17:23:47.720Z",
                                         "event":"update",
                                         "content-state":{
                                            "deliveryStatus":2,
                                            "deliveryTime":5
                                         }
                                      }
                                   }
                                }
                             ]
                          }
                       }
                    }
        
        
            .. tab:: SECURE

                Параметры для передачи чувствительных данных в push-уведомлении. 
        
                .. code-block:: json
                   :linenos:
                   :emphasize-lines: 14-20

                    {
                       "login":"ВАШ_ЛОГИН",
                       "password":"ВАШ_ПАРОЛЬ",
                       "id":"4560",
                       "message":{
                          "type":"PUSH",
                          "data":{
                             "primaryOn":false,
                             "externalUserId":"ИД_абонента",
                    	 "title": "Код для получения %data%",
                             "text":"%name%, ваша карта с номером %card% готова к выпуску",
                             "serviceNumber":"Номер_отправителя",
                             "ttl":30,
                             "ttlUnit":"SECONDS",
                             "Options":[
                                {
                                   "param_name":"SECURE",
                                   "param_value":{
                                      "name":"Имя",
                                      "card":"*0000",
                                      "data":"12345"
                                   }
                                }
                             ]
                          }
                       }
                    }


            .. tab:: SENDING_PLATFORM

                Параметры для отправки push-уведомлений на определенные типы платформ (APNS, FCM, HMS, RuStore) по желанию партнера. 
        
                .. code-block:: json
                   :linenos:
                   :emphasize-lines: 14-22

                    {
                       "login":"ВАШ_ЛОГИН",
                       "password":"ВАШ_ПАРОЛЬ",
                       "id":"1",
                       "message":{
                          "type":"PUSH",
                          "data":{
                             "serviceNumber":"Сервисное_имя_отправителя",
                             "externalUserId":"ИД_абонента",
                             "text":"Текст_сообщения",
                             "title":"Заголовок_сообщения",
                             "ttl":24,
                             "ttlUnit":"HOURS",
                             "Options":[
                                {
                                   "param_name":"SENDING_PLATFORMS",
                                   "param_value":[
                                      "Android",
                                      "Ios",
                                      "RuStore"
                                   ]
                                }
                             ]
                          }
                       }
                    }



Параметры запросов  
~~~~~~~~~~~~~~~~~~~~

**Обязательные** параметры выделены **жирным** шрифтом.

+----------------------------------+------------------+--------------------------------------------------------------------------------+
| Параметр                         | Тип данных       | Описание                                                                       |
+==================================+==================+================================================================================+
| **login**                        | string           | Имя Партнера в системе.                                                        |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| **password**                     | string           | Пароль Партнера в системе.                                                     |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| extraParam                       | string           | | Дополнительные параметры, передаваемые в виде *param1=value1,param2=value2*, |
|                                  |                  |   где                                                                          |
|                                  |                  |                                                                                |
|                                  |                  | * *param1* и *param2* -- названия параметров;                                  |
|                                  |                  | * *value1* и *value2* -- значения.                                             |
|                                  |                  |                                                                                |
|                                  |                  | | Символ запятой в название параметра входить не может, но может входить       |
|                                  |                  |   в его значение -- в этом случае он должен удваиваться.                       |
|                                  |                  | | Пример: строка место=абзаково,название=гостевой дом-2,координаты=53.8085896,,|
|                                  |                  |   58.6362112,c=23.02.09,по=05.03.09.                                           |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| _`useTimeDiff`                   | boolean          | | Учитывание часового пояса при запуске рассылки.                              |
|                                  |                  | | Если *true*, то отправка сообщения осуществляется абоненту согласно          |
|                                  |                  |   расписанию рассылки и его часовому поясу.                                    |
|                                  |                  | | Если *false*, то сообщение отправляется согласно расписанию инициатора       |
|                                  |                  |   рассылки UTC+3, без учёта часового пояса получателя сообщения.               |
|                                  |                  | | Значение по умолчанию: *false*.                                              |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| _`scheduleInfo`                  | object           | | Расписание рассылки. Если не указано, отправляется сразу же, в момент        |
|                                  |                  |   получения запроса.                                                           |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| scheduleInfo/timeBegin           | string           | Время начала, например, «10:00».                                               |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| scheduleInfo/timeEnd             | string           | Время окончания, например, «21:00».                                            |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| scheduleInfo/weekdaysSchedule    | string           | | Дни рассылки. Задаются цифрами от 1 (понедельник) до 7 (воскресение),        |
|                                  |                  |   например, «12345».                                                           |
|                                  |                  | | Если ограничений по дням недели нет, то данный параметр может быть пустой    |
|                                  |                  |   или не передан в запросе.                                                    |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| scheduleInfo/deadline            | string           | Дата окончания рассылки, например, *2024-09-10T16:29:30+0300*.                 |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| _`id`                            | string           | | Уникальный идентификатор на стороне Партнёра.                                |
|                                  |                  |   Данный параметр нужен для  контроля повторных отправок и дублирования        |
|                                  |                  |   (сервис контроля включается отдельно).                                       |
|                                  |                  | | Партнёр может вызывать Сервис-провайдера (запрос на отправку сообщения)      |
|                                  |                  |   с одним и тем же id несколько раз. При этом: отправка сообщения абоненту     |
|                                  |                  |   будет выполнена только один раз (по первому запросу).                        |
|                                  |                  | | В ответах на запросы Сервис-провайдер вернет Партнёру один и тот же          |
|                                  |                  |   идентификатор сообщения в системе Сервис-провайдера (тот же, что на          |
|                                  |                  |   первый запрос).                                                              |
|                                  |                  | | Сервис-провайдер опционально возвращает Партнёру данный идентификатор        |
|                                  |                  |   при его наличии в отчёте о доставке сообщения.                               |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| _`destAddr`                      | string           | | Для Push-сообщений является обязательным при отсутствии параметра            |
|                                  |                  |   message/data/externalUserId. Номер телефона абонента. Содержит код страны,   |
|                                  |                  |   код оператора и номер телефона. Для РФ код может быть '8', '7' или '+7'.     |
|                                  |                  | | Примеры номеров: 72101234567, +72101234567, 8-210-123-45-67, 82101234567.    |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| **message**                      | object           | Параметры отправляемого сообщения.                                             |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| **message/type**                 | enum             | Тип сообщения. Передается значение *PUSH*.                                     |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| **message/data**                 | object           | Параметры отправляемых данных.                                                 |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/externalUserId      | string           | ID пользователя для отправки Push-сообщения (логин, email, UID).               |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *message/data/ttl*               | integer          | | Срок жизни сообщения. Допустимый диапазон, мин: от 1 до 2880.                |
|                                  |                  | | Примечания. При *ttl = 0* или отсутствии параметра в запросе берётся значение|
|                                  |                  |   из настроек по умолчанию, которые задаются при настройке интеграции отдельно |
|                                  |                  |   для каждого клиента.                                                         |
|                                  |                  | | Если *ttl* не указан в данных местах, то запрос будет отклонён               |
|                                  |                  |   системой и будет выведена ошибка.                                            |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/ttlUnit             | enum             | Единица измерения периода доставки сообщения. Передается только вместе с *ttl*.|
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| **message/data/serviceNumber**   | string           | Сервисное имя, от которого осуществляется отправка сообщения.                  |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| **message/data/text**            | string           | | Текст отправляемого сообщения. Количество символов: не более 1000.           |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *Запрос с заголовком*  _`title`                                                                                                      |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/title               | string           | Заголовок для текстового сообщения. Количество символов, не более: 80.         |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *Запрос с признаком главного приложения*    _`primaryOn`                                                                             |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/primaryOn           | boolean          | Признак главного приложения, установленного на устройство абонента.            |
|                                  |                  | Возможные значения:                                                            |
|                                  |                  |                                                                                |
|                                  |                  | - true -- отправка только на основное устройство пользователя;                 |
|                                  |                  | - false -- отправка на все устройства пользователя.                            |
|                                  |                  |                                                                                |
|                                  |                  | Если параметр отсутствует, то передается тоже на все устройства пользователя.  |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| registeredDelivery               | integer          | | Необходимость отчётов о доставке.                                            |
|                                  |                  | | Возможные значения:                                                          |
|                                  |                  |                                                                                |
|                                  |                  | * 0 - статусы не нужны;                                                        |
|                                  |                  | * 1 - нужны статусы (по умолчанию);                                            |
|                                  |                  | * 2 - нужны только «Не доставлено».                                            |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| notifyUrl                        | string           | | Hostname входящего api для получения отчета о доставке (см.                  |
|                                  |                  |   :doc:`rest_status`).                                                         |
|                                  |                  | | Этот параметр в запросе необязательный, но при его отправке нужно учесть     |
|                                  |                  |   следующее:                                                                   |
|                                  |                  |                                                                                |
|                                  |                  | * если парметр указан, он не может быть пустым;                                |
|                                  |                  | * длина строки *notifyUrl* не должна превышать 2048 символов.                  |
|                                  |                  |                                                                                |
|                                  |                  | | При невыполнении любого из указанных условий будет сгенерирована ошибка,     |
|                                  |                  |   запрос не будет выполнен.                                                    |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *Запрос с указанием категории содержимого (изображений, HTML-ссылок и кнопок)*    _`contentCategory`                                 |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/content             | object           | Параметры для отправки изображений, HTML-ссылок и кнопок.                      |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/content/            | enum             | | Категория содержимого по ссылке contentUrl.                                  |
| contentCategory                  |                  | | Возможные значения:                                                          |
|                                  |                  |                                                                                |
|                                  |                  | * IMAGE --  для передачи в *contentUrl* ссылки на изображение;                 |
|                                  |                  | * HTML --  для передачи в *contentUrl* ссылки для перехода. При переходе в     |
|                                  |                  |   Push-сообщение передаваемая ссылка откроется в webView.                      |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/content/contentUrl  | string           | | URL-адрес изображения или HTML. Максимальная длина ссылки, символов: 512.    |
|                                  |                  | | Требования к изображению при *contentCategory=IMAGE*:                        |
|                                  |                  |                                                                                |
|                                  |                  | * форматы изображения: JPEG, PNG, GIF, BMP;                                    |
|                                  |                  | * размер изображения: не более 1 МБ;                                           |
|                                  |                  | * соотношение сторон: 2:1.                                                     |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *Запрос для отображения кнопок*  _`actions`                                                                                          |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/content/actions     | array            | | Массив, в котором передаются кнопки с возможностью:                          |
|                                  |                  |                                                                                |
|                                  |                  | * открыть сообщение;                                                           |
|                                  |                  | * перейти по заданной ссылке.                                                  |
|                                  |                  |                                                                                |
|                                  |                  | | Описание атрибутов кнопки приведено ниже.                                    |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/content/actions/    | string           | Надпись на кнопке. Количество символов, не более: 64.                          |
| title                            |                  |                                                                                |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/content/actions/    | string           | | Текстовый идентификатор кнопки в мобильном приложении. Определяет действие,  |
| action                           |                  |   которое будет выполняться при клике на кнопку. Параметр настраивается в      |
|                                  |                  |   мобильном приложении.                                                        |
|                                  |                  | | Количество символов, не более: 64.                                           | 
|                                  |                  | | Допустимые значения:                                                         |
|                                  |                  |                                                                                | 
|                                  |                  | * open-app (открыть приложение);                                               |
|                                  |                  | * link (перейти по заданной ссылке).                                           |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/content/actions/    | string           | | Дополнительные параметры кнопки. Набор зависит от ОС, определяется           |
| options                          |                  |   разработчиком мобильного приложения. Параметр настраивается в мобильном      |
|                                  |                  |   приложении.                                                                  |
|                                  |                  | | Количество символов, не более: 300.                                          | 
|                                  |                  | | В случае кнопки с action=link может быть указан URL-адрес для перехода.      |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *Запрос с подписками*    _`deviceSubscriptions`                                                                                      |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/deviceSubscriptions | array            | Передаваемый массив с перечнем подписок мобильного приложения.                 |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *Запрос с данными для приложения*   _`customPayload`                                                                                 |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/customPayload       | JSON Object      | Данные, которые передаются в исходном виде для дальнейшей обработки на уровне  |
|                                  |                  | клиентского приложения.                                                        |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *Запрос с данными для статистики*   _`callbackData`                                                                                  |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/callbackData        | string           | Клиентские данные для статистики. При получении сохраняются в передаваемом     |
|                                  |                  | виде, при необходимости возможен вывод в статистических данных.                |
+----------------------------------+------------------+--------------------------------------------------------------------------------+ 
| *Запрос с обогащенными данными*   _`extraOptions`                                                                                    |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions        | array            | Массив объектов дополнительных данных от партнера.                             |
|                                  |                  | Содержит два обязательных параметра: *param_name* и *param_value*.             |
+----------------------------------+------------------+--------------------------------------------------------------------------------+ 
| **message/data/extraOptions/     | string           | | Передача признака сообщения.                                                 |
| param_name**                     |                  | | Возможные значения:                                                          |
|                                  |                  |                                                                                |
|                                  |                  | * RICH -- данные для альтернативного варианта отправки данных с контентом      |
|                                  |                  |   для мобильного приложения;                                                   |
|                                  |                  | * LIVE_ACTIVITY -- данные для обновления виджета Live Activity на              |
|                                  |                  |   устройствах с операционной системой iOS;                                     |
|                                  |                  | * SECURE -- параметры для передачи чувствительных данных в push-уведомлении.   |
|                                  |                  | * SENDING_PLATFORMS -- параметры для передачи push-уведомлений на определенные |
|                                  |                  |   типы платформ (APNS, FCM, HMS, RuStore).                                     |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| **message/data/extraOptions/     | string           | В зависимости от переданного в *param_name* признака данные в *param_value*    |
| param_value**                    |                  | будут отличаться.                                                              |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *param_name=RICH*                                                                                                                    |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions/       | string           | Заголовок сообщения. Если приходит, то происходит подмена присланного          |
| param_value/title                |                  | заголовка или задается заголовок вместо пустого.                               |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions/       | string           | Текст сообщения. Если приходит в RICH, то происходит подмена присланного       |
| param_value/message              |                  | текста.                                                                        |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions/       | string           | Тип контента. Если приходит, то заменяется вместе с url. Если URL пустой,      |
| param_value/content-category     |                  | то *content-category* игнорируется.                                            |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions/       | string           | Ссылка для контента. Если не указан тип контента, то подставляется как url     |
| param_value/content-url          |                  | вместо присланного. Если url не присылается и типа контента не было прислано,  |
|                                  |                  | то игнорируется.                                                               |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions/       | string           | Пользовательские данные. Если приходит, то заменяют присланные ранее или       |
| param_value/custom-payload       |                  | задаются новые данные, если не было прислано ранее.                            |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions/       | array            | Список кнопок. Если приходят не пустые данные, то происходит замена            |
| param_value/actions              |                  | присланного ранее контента.                                                    |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *param_name=LIVE_ACTIVITY*                                                                                                           |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions/       | timestamp        | *timestamp* в формате ISO 860 — дата и время, когда Live Activity считается    |
| param_value/aps/stale_date       |                  | устаревшим.                                                                    |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions/       | timestamp        | *timestamp* в формате ISO 8601 — дата и время, когда Live Activity закрывается |
| param_value/aps/dismissal_date   |                  | на экране блокировки. После того, как виджет перестанет быть активным, он может|
|                                  |                  | еще 4 часа оставаться на экране блокировки, если его не закрыть. Чтобы закрыть |
|                                  |                  | сразу и не ждать, можно указать дату, которая уже прошла.                      |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| **message/data/extraOptions/     | timestamp        | *timestamp* в формате ISO 8601.                                                |
| param_value/aps/timestamp**      |                  |                                                                                |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| **message/data/extraOptions/     | string           | Событие для обновления Live Activity, принимает следующие значения:            |
| param_value/aps/event**          |                  |                                                                                |
|                                  |                  | * update (для обновления);                                                     |
|                                  |                  | * end (для деактивации).                                                       |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions/       | object           | | Данные, которые будут отображаться в виджете Live Activity.                  |
| param_value/aps/content_state    |                  | | Параметры передаются разработчиком виджета. Данный блок не валидируется.     |
|                                  |                  | | В demo приложении реализовано:                                               |
|                                  |                  |                                                                                |
|                                  |                  | - *deliveryStatus* — статус активити:                                          |
|                                  |                  |                                                                                |
|                                  |                  |   * 1 — старт новой активити (при передаче в запросе придет обычное            |
|                                  |                  |     push-уведомление;                                                          |
|                                  |                  |   * 2 — обновление запущенной активити с *event=update*;                       |
|                                  |                  |   * 3 — завершение запущенной активити с *event=end*;                          |
|                                  |                  | - *deliveryTime* — время доставки push-уведомления;                            |
|                                  |                  | - *alert* — содержит данные для отображения в виджете (реализуется на стороне  |
|                                  |                  |   мобильного приложения).                                                      |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *param_name=SECURE*                                                                                                                  |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions/       | string           | | Наименования параметров с чувствительными данными (*param_name=SECURE*).     |
| param_value                      |                  | | При отправке через облачных провайдеров чувствительные данные, передаваемые  |
|                                  |                  |   в push-уведомлении, маскируются при помощи шаблонов (подстановки в тексте и  |  
|                                  |                  |   заголовке уведомления).                                                      |
|                                  |                  | | Требования к наименованию параметров с данными для подстановки:              |
|                                  |                  |   * текст должен быть на латинице;                                             |
|                                  |                  |   * использование спец. символов недопустимо.                                  |
|                                  |                  |                                                                                |
|                                  |                  | | На примере выше (запрос с обогащенными данными *SECURE*) в тексте и          |
|                                  |                  |   заголовке сообщения указаны переменные %name%, %card% и %data%.              |
|                                  |                  | | Соответственно, эти значения обязательно должны быть переданы в *param_value*|
|                                  |                  |   для дальнейшей подстановки.                                                  |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| *param_name=SENDING_PLATFORMS*                                                                                                       |
+----------------------------------+------------------+--------------------------------------------------------------------------------+
| message/data/extraOptions/       | string           | | Перечень наименований провайдеров, на которые необходимо выполнить отправку  |
| param_value                      |                  |   сообщений.                                                                   |
|                                  |                  | | Возможные значения:                                                          |
|                                  |                  |                                                                                |
|                                  |                  | * Android;                                                                     |
|                                  |                  | * Ios;                                                                         |
|                                  |                  | * Huawei;                                                                      |
|                                  |                  | * RuStore.                                                                     |
+----------------------------------+------------------+--------------------------------------------------------------------------------+



Ответ на запрос 
-----------------

После отправки сообщения Сервис-провайдер синхронно возвращает ответ. В случае успешной отправки возвращается HTTP-code 200 OK.

Ответ при успешной отправке
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. tabs::

    .. tab:: Пример ответа

      .. code-block:: json
         :linenos:

           {
              "mtNum": "7390612217"
              "id": "8770599"
           }


    .. tab:: Параметры ответа

      .. csv-table:: 
          :header: "Параметр", "Тип данных", "Описание"
          :widths: 30, 15, 35
          :class: my-table

          "mtNum", "string", "Идентификатор цепочки отправки, присваиваемый платформой Сервис-провайдера."
          "id", "string", "Уникальный идентификатор на стороне Партнёра. Присутствует, если был передан при отправке."
          


Ошибки при отправке  
~~~~~~~~~~~~~~~~~~~~~~~

Для ошибочных результатов HTTP-код ответа будет отличный от 200 (см. :ref:`Коды-ошибок-отправки-push`).

.. tabs::

   .. tab:: Пример ответа с ошибкой

      .. code-block:: json   
           :linenos:

            { 
                "error": { 
                   "code": 1, 
                   "description": "Service is unavailable" 
                }
            }



   .. tab:: Параметры ответа

      .. csv-table:: 
        :header: "Параметр", "Тип данных", "Описание"
        :widths: 30, 15, 35
        :class: my-table

        "error", "object", "Информация об ошибке."
        "error/code", "int", "Код ошибки."
        "error/description", "string", "Краткое описание ошибки."
        "extendedDescription", "string", "Подробное описание ошибки (необязательный параметр)."


.. _Коды-ошибок-отправки-push:

Коды ошибок отправки  
~~~~~~~~~~~~~~~~~~~~~~~

.. csv-table:: 
   :header: "Код", "Описание", "HTTP-код"
   :widths: 7, 30, 15
   :class: my-table

   1, "Service is unavailable", "503"
   2, "Invalid IP-address", "403"
   3, "Too many connections", "429"
   4, "Invalid request", "400"
   5, "Invalid login", "401"
   6, "Invalid password", "401"
   7, "serviceNumber is not defined", "400"
   8, "destAddr is not correct", "406"
   9, "Message type is not correct", "406"
   10, "Prohibited sending duplicates", "409"
   11, "Invalid TTL", "406"
   100, "100", "500"
        



Статусы доставки push-уведомлений
------------------------------------

Для получения статусов push-уведомлений необходимо настроить :doc:`rest_status`.
