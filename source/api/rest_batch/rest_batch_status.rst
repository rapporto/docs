Сервис получения статусов доставки
=======================================

| Передачу статусов сообщений Сервис-провайдер осуществляет по нотификационной схеме.
| При изменении статуса сообщения отправляется POST-запрос на URL, указанный при отправке сообщения в параметре *callbackUrl*. 
| В ответ на запрос ожидается HTTP-код: *200*.
| В случае, если на запрос возвращен HTTP-код *500 (Internal Error)*, предпринимаются попытки доставить статус до пяти раз с интервалом в минуту.


Примеры запросов
---------------------------

.. tabs::

    .. tab:: Статус DELIVERED

        .. code-block:: json

            {
            "messageId": "3597944866766620289",
            "ts": 1613404835977,
            "status": "DELIVERED"
            }

    .. tab:: Статус REJECTED

        .. code-block:: json

            {
                "messageId": "3597944866766620289",
                "ts": 1613404835977,
                "status": "REJECTED",
                "errorCode": 0
                "id": "super_id_1"
            }



Описание параметров
-----------------------

.. note:: В таблице с телом запроса обязательные параметры отмечены **жирным** шрифтом.

+---------------------------------+-------------------+-------------------------------------------------------------------------------+
| Параметр                        | Тип               | Описание                                                                      |
+=================================+===================+===============================================================================+
| **messageId**                   | string            | Уникальный идентификатор сообщения на платформе Сервис-провайдера.            |
+---------------------------------+-------------------+-------------------------------------------------------------------------------+
| **ts**                          | long              | Время события в миллисекундах.                                                |
+---------------------------------+-------------------+-------------------------------------------------------------------------------+
| **status**                      | string            | Текущий статус сообщения (см. :ref:`RB-Статусы-сообщений`).                   |
+---------------------------------+-------------------+-------------------------------------------------------------------------------+
| errorCode                       | integer           | | Для статусов REJECTED и UNDELIVERABLE передается *errorCode=0*.             |
|                                 |                   | | Для других статусов параметр *errorCode* не передается.                     |
+---------------------------------+-------------------+-------------------------------------------------------------------------------+
| id                              | string            | Идентификатор сообщения на стороне Партнёра.                                  |
|                                 |                   | Если параметр передан, то он возвращается вместе со статусом сообщения.       |
+---------------------------------+-------------------+-------------------------------------------------------------------------------+


.. _RB-Статусы-сообщений: 

Статусы сообщений
~~~~~~~~~~~~~~~~~~

+-----------------------------------+---------------------------------------------------------------+
| Статус                            | Описание                                                      |
+===================================+===============================================================+
| SENT                              | Сообщение было отправлено в сеть оператора.                   |
+-----------------------------------+---------------------------------------------------------------+
| DELIVERED                         | Сообщение доставлено абоненту.                                |
+-----------------------------------+---------------------------------------------------------------+
| EXPIRED                           | Сообщение было просрочено по сроку жизни.                     |
+-----------------------------------+---------------------------------------------------------------+
| REJECTED                          | Сообщение было отклонено оператором или Сервис-провайдером.   |
+-----------------------------------+---------------------------------------------------------------+
| UNDELIVERABLE                     | Сообщение невозможно доставить.                               |
+-----------------------------------+---------------------------------------------------------------+
| ACCEPTED                          | Сообщение было принято.                                       |
+-----------------------------------+---------------------------------------------------------------+
| UNKNOWN                           | Произошла неизвестная ошибка.                                 |
+-----------------------------------+---------------------------------------------------------------+

.. warning:: Для SMS-сообщений, отправленных абонентам оператора Мегафон, с 01.03.2023 прекращена передача статусов "Доставлено" и "Не доставлено".

